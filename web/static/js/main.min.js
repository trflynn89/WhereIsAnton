function getLocations(e){s_showAll=e,getAPI("/locations/",showLocations)}function getDrunks(){getAPI("/drunk/",showDrunks)}function createDrunk(e,t){postAPI("/drunk/",{time:e,drunk:t})}function timeComparator(e,t){return e.time<t.time?1:e.time>t.time?-1:0}function showLocations(e){if(0!=e.length)if(e.sort(timeComparator),clearMarkers(),clearPath(),s_showAll){for(var t=new google.maps.LatLngBounds,a=[],n=0;n<e.length;++n){var o=e[n].latitude,r=e[n].longitude,s=e[n].address,i=addMarker(o,r,s);t.extend(i),a.push(i)}s_map.fitBounds(t),addPath(a)}else{var o=e[0].latitude,r=e[0].longitude,s=e[0].address;s_map.setCenter(new google.maps.LatLng(o,r)),s_map.setZoom(8),addMarker(o,r,s)}}function showDrunks(e){var t=getName();if(0==e.length)return void Lobibox.alert("error",{title:"Nope!",msg:t+" has never been drunk :("});e.sort(timeComparator);var a=e[0].drunk,n=new Date(e[0].time).getTime(),o=(new Date).getTime(),r=Math.ceil((o-n)/MILLIS_PER_HOUR);a&&r>s_drunkTimeout&&(sTime=n+s_drunkTimeout*MILLIS_PER_HOUR,createDrunk(sTime,!1),r=Math.ceil((o-sTime)/MILLIS_PER_HOUR),a=!1);var s=a?"Yes!":"Nope!",i=a?" drunk ":" sober ",l=1==r?" hour":" hours",u=a?" :)":" :(",d=a?"info":"error",m=t+" has been"+i+"for "+r+l+u;Lobibox.alert(d,{title:s,msg:m})}function addMarker(e,t,a){for(var n=new google.maps.LatLng(e,t),o=0;o<s_markers.length;++o){var r=s_markers[o].position;if(r.lat()===e&&r.lng()===t)return n}var s=new google.maps.Marker({position:n,map:s_map});return labelMarker(s,a),s_markers.push(s),n}function clearMarkers(){for(var e=0;e<s_markers.length;++e)s_markers[e].setMap(null);s_markers=[]}function labelMarker(e,t){var a=new google.maps.InfoWindow({content:t});a.open(e.getMap(),e),e.addListener("click",function(){a.open(e.getMap(),e)})}function addPath(e){for(var t=[],a=0;a<e.length;++a)if(t.push(e[a]),a+1<e.length){var n=new google.maps.LatLngBounds;n.extend(e[a]),n.extend(e[a+1]);var o=n.getCenter(),r=new google.maps.LatLng(o.lat()+rand(0,4),o.lng()+rand(0,4));t.push(r)}s_path=new google.maps.Polyline({path:t,strokeColor:"#ff0000",stokeOpacity:.85,strokeWeight:2,geodesic:!0}),s_path.setMap(s_map)}function clearPath(){null!==s_path&&(s_path.setMap(null),s_path=null)}function getAPI(e,t){setLoadStatus(!0),$.get(e,function(e){"undefined"!=typeof t&&t(e.data),setLoadStatus(!1)})}function postAPI(e,t,a){$.post(e,t,function(e){"undefined"!=typeof a&&a(e)})}function setLoadStatus(e){e?$(".hamburger").children().addClass("loading"):$(".hamburger").children().removeClass("loading")}function rand(e,t){var a=Math.random()<.5?-1:1;return a*(Math.random()*(t-e)+e)}var s_map=null,s_path=null,s_markers=[],s_showAll=!1,s_drunkTimeout=10,MILLIS_PER_HOUR=36e5;$(document).ready(function(e){s_map=new google.maps.Map(document.getElementById("map"),{disableDefaultUI:!0,center:{lat:0,lng:0},zoom:2}),getLocations(!1)});
